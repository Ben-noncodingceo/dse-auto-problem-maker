# Cloudflare Workers 配置文件
name = "dse-backend"
main = "apps/backend/src/index.ts"
compatibility_date = "2024-01-01"

# 环境变量（这里只放非敏感配置）
[vars]
NODE_ENV = "production"
CORS_ORIGIN = "https://your-pages-url.pages.dev"  # 部署后替换为实际的 Pages URL

# Secrets（敏感信息）需要通过命令行或 Dashboard 设置：
# - DATABASE_URL
# - DEEPSEEK_API_KEY (或其他 LLM API Key)

# 绑定 D1 数据库（Cloudflare 的 SQL 数据库）
# 注意：也可以使用外部 PostgreSQL
# [[d1_databases]]
# binding = "DB"
# database_name = "dse-database"
# database_id = "your-database-id"

# KV 存储（可选，用于缓存）
# [[kv_namespaces]]
# binding = "CACHE"
# id = "your-kv-id"

# 构建配置
[build]
command = "pnpm install && pnpm --filter @dse/backend build"

[build.upload]
format = "service-worker"
